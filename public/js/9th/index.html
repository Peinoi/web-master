<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous">
  </script>

</head>

<body>
  <h3>Emp 데이터 목록</h3>
  <form action="#">
    <div class="input-group">
      <label for="empno">empno</label>
      <input type="text" id="empno" name="empno" required />
    </div>
    <div class="input-group">
      <label for="ename">ename</label>
      <input type="text" id="ename" name="ename" required />
    </div>
    <button type="submit" class="save">저장</button>
  </form>
  <table class="table">
    <thead>
      <tr>
        <th>사번</th>
        <th>이름</th>
        <th>직업</th>
        <th>급여</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>
  <script>
    //http://localhost:3000/emp => json데이터.
    fetch('http://localhost:3000/emp')
      .then(response => response.json())
      .then((result) => {
        // console.log(result);
        result.forEach((item) => {

          let tr = makeRow(item);
          document.querySelector('#list').appendChild(tr);
        });
      })
      .catch((err) => console.log(err));

    function makeRow(employee) {
      let fields = ['EMPNO', 'ENAME', 'JOB', 'SAL'];
      let tr = document.createElement('tr');
      tr.setAttribute("data-eno", employee.EMPNO);
      fields.forEach((item) => {
        let td = document.createElement('td');
        td.innerHTML = employee[item];
        tr.appendChild(td);
      })
      let btn = document.createElement('button');
      btn.innerHTML = "삭제";
      let td = document.createElement('td');
      btn.addEventListener('click', deleteFunc);
      td.appendChild(btn);
      tr.appendChild(td);
      return tr;
    }

    function deleteFunc(e) {

      let thisTr = this.parentElement.parentElement;
      let eno = this.parentElement.parentElement.dataset.eno;
      fetch(`http://localhost:3000/emp/` + eno)
        .then(response => response.json())
        .then(result => {
          if (result.rowsAffected) {
            alert("성공");
            thisTr.remove();
          } else {
            alert("실패");
          }
        })
        .catch((err) => {
          console.log(err)

        })
    }
  </script>
</body>

</html>